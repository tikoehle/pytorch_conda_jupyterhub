## Installing the NVIDIA CUDA toolkit on Ubuntu 18.04

### Check if the new NVIDIA GPU really exists

```
lspci | grep -i nvidia
```

### Install Linux headers
```
sudo apt-get install linux-headers-$(uname -r)
```

### Download and install the cuda driver .deb package
https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&target_distro=Ubuntu&target_version=1804&target_type=deblocal

```
cd Downloads/
sudo dpkg -i cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb 
sudo apt-key add /var/cuda-repo-10-0-local-10.0.130-410.48/7fa2af80.pub
sudo dpkg -i cuda-repo-ubuntu1804-10-0-local-10.0.130-410.48_1.0-1_amd64.deb 
sudo apt update
sudo apt install cuda
```

### Update the $PATH for nvidia tools

```
tee -a $HOME/.bashrc >/dev/null <<EOF

# NVIDIA CUDA Tools PATH
export PATH=/usr/local/cuda/bin${PATH:+:${PATH}}

EOF

source .bashrc
```

### Verify the CUDA installation

```
cat /proc/driver/nvidia/version
nvcc --version
nvidia-smi
```

A CUDA compatible version of the NVIDIA driver is installed as part of the CUDA Toolkit installation. 
By adding the Ubuntu nvidia-drivers ppa, apt takes care of updating nvidia-drivers, hoping that the 
drivers version is compatible to the CUDA version. The compatibility matrix is in Table 1 at
https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html.

```
sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update
sudo apt upgrade
```

To freeze the nvidia-driver to a particulat version, so

```
sudo apt-mark hold nvidia-graphics-drivers-<version>
```

### Reboot and check the nvidia-drivers version

```
nvidia-smi
```

## Notes
After the installation (of ?) a new service exists:

```
systemctl status nvidia-persistenced
```
See https://download.nvidia.com/XFree86/Linux-x86/384.59/README/nvidia-persistenced.html

## References
https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html
https://developer.nvidia.com/cuda-downloads
https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html
